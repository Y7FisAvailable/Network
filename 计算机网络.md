---
date: 2024-08-08
tags:
  - 计网
---
# 一、概述
## 1.1信息时代
![[Pasted image 20240809110508.png]]
![[Pasted image 20240809110535.png]]
## 1.2因特网概述
**简单网络** = 节点（台式机、笔记本、服务器、打印机、交换机...）+ 链路

**互连网internet（网络的网络）** = 网络——路由器（互联）——网络

**因特网Internet** = 最大的互连网，**通信协议为TCP/IP协议族**
![[Pasted image 20240809111720.png]]

![[Pasted image 20240809111821.png]]

![[Pasted image 20240809112313.png]]
![[Pasted image 20240809112436.png]]

![[Pasted image 20240809112714.png]]
用户主机也可以成为一个ISP，只需要有调制解调器、路由器等设备即可。

![[Pasted image 20240809112907.png]]

![[Pasted image 20240809112944.png]]

![[Pasted image 20240809113133.png]]
## 1.3电路、分组、报文交换
### 1.3.1电路交换
![[Pasted image 20240809113704.png]]
**计算机之间的数据传送是突发式**的（即时通信），当使用电路交换来传送计算机数据时，其**线路的传输效率一般都会很低**， 线路上真正用来传送数据的时间往往不到10%甚至1%。
### 1.3.2分组交换
![[Pasted image 20240809114722.png]]
![[Pasted image 20240809144042.png]]
主机H1-->H3：
主机H1将要发送的报文切分为小的数据段，将数据段加上首部构成一个分组，然后依次发送分组，分组在路由器R1处被缓存、查转发表、转发到下一个交换节点，最终全部分组被发送至主机H3，H3接收分组，然后还原为报文。
![[Pasted image 20240809144358.png]]
### 1.3.3报文交换
![[Pasted image 20240809144506.png]]
### 1.3.4三种交换方式的对比
![[Pasted image 20240809144816.png]]
![[Pasted image 20240809144906.png]]
## 1.4计算机网络的定义和分类
### 1.4.1定义
- 早期定义：
互连（有线链路、无线链路）、自治（每台主机有软硬件，可独立运行）、计算机集合（两台及以上主机）

- 现阶段定义：
![[Pasted image 20240809150026.png]]
### 1.4.2分类
1. 按交换方式：电路交换、报文交换、分组交换
2. 按使用者：公用网、专用网（军队、铁路、电力）
3. 按传输介质：
	- 有线：双绞线、光纤...
	- 无线：wifi
4. 按覆盖范围：
![[Pasted image 20240809150815.png]]
5. 按拓扑结构：
![[Pasted image 20240809151220.png]]
## 1.5计算机网络的性能指标
计算机网络的性能指标被用来从不同方面**度量计算机网络的性能**。
### (1)速率
![[Pasted image 20240809152246.png]]
![[Pasted image 20240809152710.png]]
数据量（大小）是2^10
速率（快慢）是10^3
![[Pasted image 20240809153547.png]]
### (2)带宽
指信道的传输能力，也就是理想状态下在这条信道上所能传输信号的**最大速率**，可能没有那么多数据要传输，那么实际速率会低于带宽。
![[Pasted image 20240809154112.png]]
![[Pasted image 20240809154417.png]]
**所以构建网络时、后续计算时，需要注意设备间和传输介质的速率匹配情况。**
### (3)吞吐量
比如带宽为100Mb/s（俗称100M），但是此时我看视频的下载速率为20Mb/s，所以吞吐量就是20Mb/s。
![[Pasted image 20240809155016.png]]
吞吐量=上传速率和下载速率之和
### (4)时延
时延是指**数据从网络的一端传送到另一端所耗费的时间**，也称为延迟或迟延。数据可由一个或多个分组、甚至是仅由一个比特bit构成。
![[Pasted image 20240809160724.png]]
发送时延是指在源主机中，数据送到网卡的时间长短，也就是将要传输的全部数据放到信道上的时间。

![[Pasted image 20240809162238.png]]
**数据被转换为信号（携带信息的电磁波），信号在链路上传播。信号分为两种类型：模拟信号和数字信号，这两种信号都是电磁波。**

光纤快的原因是，带宽大，类似大卡车，虽然没跑车快，但是单次运输量大。

存在接收时延吗？分组信号在链路上传播和目的主机接收信号是同时进行的，所以无需计算接收时延。
#### 多分组分组转发的时延图解
![[Pasted image 20240809175344.png]]
路由器在发送上一个分组的**同时**还在接收下一个分组。
![[Pasted image 20240809175841.png]]
**假设各分组等长、各链路等长、主机和路由器发送速率相等。源主机通过n个路由器，转发m个分组到目的主机的时延计算公式：**
`总延时 = m*发送时延 + n*发送时延 + (n+1)*传播时延 = (m+n)*发送时延 + (n+1)*传播时延`
`其中(n+1)*传播时延是最后一个分组的总传播时延`

#### 习题1
![[Pasted image 20240809190957.png]]
所有链路数据传输速率100Mbps，则发送速率一样；不考虑分组拆装时间且说明文件大小980000B需要减去分组头的20B；求最少时间，则是选择路由器最少的线路。
#### 习题2
![[Pasted image 20240809193824.png]]
在不考虑排队时延和处理时延的情况下，发送时延和传播时延谁占主导？**要视具体情况而定。**

注意：发送速率=min\[主机接口速率，线路带宽，交换机或路由器的接口速率]
### (5)总结前四个性能指标
![[Pasted image 20240809194747.png]]
### (6)时延带宽积
时延带宽积是**传播时延**和**带宽**的乘积。
传播时延：链路长度
带宽：横截面
![[Pasted image 20240809200313.png]]

![[Pasted image 20240809200932.png]]
![[Pasted image 20240809200833.png]]
结论：光纤链路长1km,则信号传播时延为5μs（微秒）

主机A向主机B连续发送数据时，当第一个bit即将到达主机B时，此时发送端主机A已经发送了**时延带宽积个bit**。
### (7)往返时间RTT
![[Pasted image 20240809201111.png]]
![[Pasted image 20240809201708.png]]
![[Pasted image 20240809201922.png]]
通过计算得知，卫星链路传播时延最大。

通过ping命令测试连通性和RTT：
![[Pasted image 20240809202130.png]]

> [!NOTE] 以太网
> 以太网（Ethernet），是当今现有局域网采用的最通用的通信协议标准。以太网络使用CSMA/CD（载波监听多路访问及冲突检测）技术，并以10M/S的速率（仅指标准以太网的速率而已）运行在多种类型的电缆上。以太网与IEEE802.3系列标准相类似。
> 以太网标准+CSMA/CD协议的局域网被称为以太网。
> 
> **以太网可以说是局域网的一种**，但是目前局域网大多数都是使用以太网标准，故可认为以太网就是局域网。然后，**局域网之间的通信协议必须是相同的**，即局域网内计算机（或计算机网络）只允许使用同一种通信规则进行通信。**而不同的局域网之间，又可以通过其他任意的通信规则进行通信**（内部只是用一种通信规则），这就构成了互联网。
> 
> 所以：以太网 <= 局域网 <= 互联网 != 因特网。
### (8)利用率
- 链路利用率：
链路利用率是指某条链路有百分之几的时间是被利用的（即有数据通过）。完全空闲的链路的利用率为零。

- 网络利用率：
网络利用率是指网络中所有链路的链路利用率的加权平均。
![[Pasted image 20240809202749.png]]

![[Pasted image 20240809203048.png]]
可见网络利用率并不是越大越好。
### (9)丢包率
接口、节点、链路、路径、网络丢包率

丢包率是指在一定的时间范围内，传输过程中**丢失的分组数量与总分组数量的比率**。

![[Pasted image 20240809203801.png]]
### (10)总结后四个性能指标
![[Pasted image 20240809204017.png]]
## 1.6计算机网络体系结构（重点）
### 1.6.1常见三种计算机网络体系结构
![[Pasted image 20240810111800.png]]

路由器的基本任务是：网络互联，所以路由器的网络体系结构中，只包含网际层和TCP/IP体系结构的网络接口层即可。

网络接口层为了互联各种接口，并没有规定什么具体内容，所以TCP/IP体系结构**在本质上只有上面三层**。
![[Pasted image 20240810113236.png]]
![[Pasted image 20240810113630.png]]

![[Pasted image 20240810113937.png]]
### 1.6.2计算机网络体系分层的必要性
分层可将庞大复杂的问题转化为若干较小的局部问题。

分层概念：高内聚，低耦合
![[Pasted image 20240816123520.png]]

![[Pasted image 20240810121204.png]]

![[Pasted image 20240810122643.png]]
**注意：
数据链路层是解决：点到点的传输问题
运输层是解决：端到端的传输问题**

![[Pasted image 20240810124240.png]]
OSI中，应用层下是表示层。对话管理——会话层；路由选择——网络层；可靠数据传输——数据链路层、运输层；选B
OSI中，自下而上第五次是会话层，选C，差错控制——数据链路层；数据格式转换——表示层；路由选择——网络层；会话管理——会话层。
TCP/IP中，传输层下一层是网络层，对话管理——归于应用层；路由选择——网络层；**端到端**报文传输——运输层，运输层；流量控制——数据链路层。

![[Pasted image 20240810130409.png]]
### 1.6.3计算机网络体系结构分层思想实例
主机和web服务器之间基于网络的通信，实际是**主机中浏览器应用进程与web服务器中web服务器应用进程之间基于网络的通信。**
![[Pasted image 20240810133942.png]]
**注意：链路层一般是给上层交付的协议数据单元（PDU）添加一个首部和尾部。**

![[Pasted image 20240810134446.png]]
### 1.6.4专用术语
OSI七层参考模型，TCP/IP四层参考模型，五层原理参考模型。
![[Pasted image 20240810135248.png]]
#### (1)实体
![[Pasted image 20240810135603.png]]
硬件，比如网卡；软件进程，比如应用层的两个应用进程。
#### (2)协议
![[Pasted image 20240810141014.png]]
![[Pasted image 20240810141428.png]]
语法规定了通信时数据包的格式（大小，顺序）
语义规定了操作流程，比如打开冰箱——取东西——合上冰箱
同步规定了通信双方时间上的先后顺序
#### (3)服务
![[Pasted image 20240810142347.png]]
![[Pasted image 20240810142505.png]]
就像盖楼一样，一楼需要地基的支持（享受地基提供的服务），二楼要盖好需要一楼的支持。下层的盖楼方法就是协议，而上层只享受你盖好，但不需要知道你是如何盖好的。

服务访问点SAP：
![[Pasted image 20240810143515.png]]

服务原语：
![[Pasted image 20240810143616.png]]

协议数据单元PDU：往下是PDU
服务数据单元SDU：往上是SDU
![[Pasted image 20240810144257.png]]
#### (4)习题
![[Pasted image 20240810144642.png]]
#### (5)总结
![[Pasted image 20240810144903.png]]





# 二、物理层
## 2.1物理层概述
物理层要实现的功能就是在各种传输媒体上传输比特（0和1），进而给上层的链路层提供透明传输比特流的服务。
![[Pasted image 20240810160016.png]]
### 2.1.1物理层接口特性
![[Pasted image 20240810161154.png]]
## 2.2物理层下面的传输媒体
![[Pasted image 20240810161543.png]]
### 2.2.1导向型传输介质
1. 同轴电缆：
![[Pasted image 20240810171728.png]]
2. 双绞线：
![[Pasted image 20240810172206.png]]
3. 光纤：
![[Pasted image 20240810172712.png]]
可见光频率高->频带带宽宽->传输带宽（通信容量）大
![[Pasted image 20240810173155.png]]
大于产生全反射临界角的角度不止一个，因此可以有入射角大于临界角的多条不同入射角的光波在同一条光纤中传输，这种光纤称为多模光纤。
![[Pasted image 20240810174042.png]]
由于色散问题，光在多模光纤的传输会出现脉冲展宽造成信号失真。
![[Pasted image 20240810174513.png]]
### 2.2.2非导向型传输介质
![[Pasted image 20240810175650.png]]

1. 无线电波
2. 微波
3. 红外线
4. 激光
5. 可见光，LiFi
## 2.3传输方式
- 并行传输/串行传输
![[Pasted image 20240810182400.png]]

- 同步传输/异步传输
![[Pasted image 20240810182835.png]]
![[Pasted image 20240810183354.png]]

- 单向通信、双向交替通信和双向同时通信
![[Pasted image 20240810183558.png]]
单工通信只需要一条信道，而半双工、全双工通信需要两条信道。
## 2.4编码与调制
### 2.4.1基本概念
![[Pasted image 20240810184344.png]]
![[Pasted image 20240812105757.png]]
数字基带信号编码后还是数字信号
数字基带信号调制后是模拟信号

![[Pasted image 20240810184632.png]]
### 2.4.2常用编码方式
双极性不归零编码：
![[Pasted image 20240810185246.png]]

双极性归零编码：
![[Pasted image 20240810185536.png]]
每个码元的一半都拿来归零了。

曼彻斯特编码：↑正跳变，↓负跳变
![[Pasted image 20240810185754.png]]

差分曼彻斯特编码：初始码元的高低电平与数据1or0无关，判断1or0只能通过有无电平跳变判断。
![[Pasted image 20240810190259.png]]
### 2.4.3习题
![[Pasted image 20240810194236.png]]
![[Pasted image 20240810194724.png]]
### 2.4.4基本带通调制方法、混合调制方法
基本调制方法：
![[Pasted image 20240810201710.png]]
PM：sin0点图像递增，sin180图像递减。

混合调制方法（从AM、FM、PM中选择混合）：
1. 因为**频率和相位**是相关的，即频率是相位随时间的变化率。所以一次只能调制频率和相位两个中的一个。  
2. **通常情况下，相位和振幅可以结合起来一起调制，称为正交振幅调制QAM**。
![[Pasted image 20240810205457.png]]
采用二进制对这16种不同的码元进行编码，需要使用4个比特(log2^16=4)。
即每个码元可以携带的信息量为4个比特。
![[Pasted image 20240810205749.png]]
![[Pasted image 20240810205930.png]]
## 2.5信道的极限容量
造成信号失真的主要因素
![[Pasted image 20240812110213.png]]
![[Pasted image 20240816135525.png]]

解释为什么传输速率越高，信号失真越大：
![[Pasted image 20240816135814.png]]
![[Pasted image 20240816140620.png]]
### 奈氏准则
![[Pasted image 20240812111114.png]]
![[Pasted image 20240812111239.png]]
无噪声情况下，就是理想低通信道。
### 香农公式
![[Pasted image 20240812111514.png]]
注意：给出信噪比dB，可以通过上面等式得到S/N。虽然S/N也叫信噪比，但不是一回事。
![[Pasted image 20240812111857.png]]
![[Pasted image 20240812111957.png]]
 奈氏准则是**理想低通信道（无噪声）下，最高码元传输速率**，单位为码元/秒
 香农公式是**带宽受限且有噪声干扰信道下，最大信息传输速率**，单位为比特/秒
 **要注意一个码元可以携带几个bit的信息量？如下题。**
![[Pasted image 20240812114059.png]]
![[Pasted image 20240812115201.png]]
这里是计算实际波特率，不考虑奈氏准则和香农（奈氏是理想低通信道，香农需要考虑带宽和噪声）！
![[Pasted image 20240812120214.png]]
![[Pasted image 20240812121313.png]]
![[Pasted image 20240812122546.png]]
2^5=X，X至少等于32
### 总结
![[Pasted image 20240812122654.png]]
## 2.6信道复用技术
### 复用技术
![[Pasted image 20240812125638.png]]
### 常见复用技术
![[Pasted image 20240812125705.png]]
#### 频分复用FDM
![[Pasted image 20240812125830.png]]
#### 时分复用TDM
![[Pasted image 20240812130006.png]]
#### 波分复用WDM
![[Pasted image 20240812130921.png]]
#### 码分复用CDM=码分多址CDMA
![[Pasted image 20240812131321.png]]
![[Pasted image 20240812133211.png]]
![[Pasted image 20240812133401.png]]
![[Pasted image 20240812133458.png]]
- 码片序列01011001
- 码片向量(-1,+1,-1,+1,+1,-1,-1,+1)
- 序列相互正交，即向量规格化内积为0
	- 内积：两个向量对应分量相乘再相加后除以长度。
![[Pasted image 20240812134810.png]]
**注意：以上四个公式的含义是：在叠加信号中抽取该站自身码片，需要用到格式化内积，内积结果为1or-1时，表示叠加信号中有给该站的信号。内积结果为0时，表示叠加信号中无给本站的信号。**
![[Pasted image 20240812135746.png]]
![[Pasted image 20240812140151.png]]
![[Pasted image 20240812140432.png]]

CMDA本质是通过格式化内积从叠加信号中区分自己的，内积为0表示非我站；内积为1or-1表示为我站的。
知道叠加信号的码片向量，知道A站的码片向量，要想看叠加信号中是否有A的信号，就将叠加信号和A的码片向量做**规格化内积**，不是A站的内容内积后**一定为0**，是A站的内积后结果为1或-1，对应比特1或0。
![[Pasted image 20240812144753.png]]
题目有问题，收到的序列是AB站叠加信号（通过AB站码片计算可以知道是谁的叠加组成），C只收到了序列，格式化内积后结果为(0,0,0)表示叠加信号中并没有C站需要收到的信号，该信号与C站无关（丢弃）。
因为序列是AB站叠加，所以想知道A站发了什么，只需要将叠加序列还原为A站和B站各自的信号即可。于是用序列和A站码片序列格式化内积得到(1,-1,1)->即(1,0,1)。
# 三、数据链路层
![[Pasted image 20240812161507.png]]
## 3.1数据链路层概述
### 3.1.1链路
![[Pasted image 20240812162920.png]]
H1->R2叫做通信路径，而不是链路，因为含有R1。该路径由两段链路构成。
### 3.1.2帧
协议数据单元PDU在数据链路层被称为：帧
![[Pasted image 20240812163144.png]]
## 3.2数据链路层的三个重要问题
1. 封装成帧、透明传输
![[Pasted image 20240812185025.png]]
![[Pasted image 20240812175940.png]]
![[Pasted image 20240812181401.png]]
2. 差错检测
由于传输中的不可控因素造成的误码（0变1，1变0）接收方如何检测误码呢？就用到了帧检验序列：FCS。
检验技术包括：奇偶校验、循环冗余校验等。
![[Pasted image 20240812184342.png]]
3. 可靠传输
![[Pasted image 20240812184913.png]]
4. PDU和SDU区别
![[Pasted image 20240812185839.png]]
****
### 3.2.1封装成帧
![[Pasted image 20240812190242.png]]
不是所有的帧都有首尾部的帧定界标志，比如以太网V2的MAC帧，只会添加8字节前导码（1字节帧开始定界符，7字节前同步码）。
![[Pasted image 20240812190632.png]]
![[Pasted image 20240812191423.png]]
各协议规定了数据载荷的上限，上限称为**最大传输单元MTU**
### 3.2.2透明传输
![[Pasted image 20240812192816.png]]
- 为了实现透明传输可以采用字节填充
在将帧交付给物理层之前，对数据载荷扫描，当帧的数据载荷内出现和帧定界符相同的数据时，可以在前面加上一个转义字符解决。接收方在剔除转义字符后继续提取数据。**同理，在数据载荷中扫描到转义字符就在前面再插入一个转义字符。**
![[Pasted image 20240812192607.png]]

- 比特填充
当帧的数据载荷恰好包含有作为帧定界符的**特定位串**时，发送方在将帧交付给物理层前先扫描，`出现连续5个比特1时，就会插入一个比特0`，这样可以确保数据载荷中不会包含帧定界符。接收方在将数据载荷向上交付网络层前，也会扫描，`出现连续5个比特1时，删除一个比特0`，从而还原出原始的数据载荷。
![[Pasted image 20240812193253.png]]

- 习题 
![[Pasted image 20240812195708.png]]
![[Pasted image 20240812201544.png]]
字符填充法：在特殊字符前添加转义字符，特殊字符：题中ESC和FLAG。
比特填充法：五个比特1后插入一个比特0。
### 3.2.3差错检测
帧检验序列字段FCS：检错码
![[Pasted image 20240814113233.png]]
从第二章可知，传输速率、距离、信道质量、噪声干扰多个因素会导致信号失真（波形难以区分别比特1和比特0），由香农公式可知提高链路信噪比S/N可以降低失真情况，即降低误码率。
#### 奇偶校验
![[Pasted image 20240814113706.png]]
![[Pasted image 20240814113831.png]]
#### 循环冗余校验CRC（常用，漏检率低）
![[Pasted image 20240814114244.png]]
![[Pasted image 20240814114806.png]]
生成多项式Gx会给出，除法中商1表示位数相同够除，商0表示是位数不够。除法做的是**异或运算，即同0异1**，最终得到的余数是**冗余码**，被添加在数据后发送出去。
![[Pasted image 20240814115338.png]]
1. 余数=0——无误码
2. 余数!=0——产生误码
![[Pasted image 20240814115601.png]]
### 3.2.4可靠传输
检测出误码后如何处理呢？？？
![[Pasted image 20240814120225.png]]
![[Pasted image 20240814120307.png]]

传输差错：
1. 误码（比特差错）
2. 分组丢失：路由缓存队列长，主动丢弃策略；
3. 分组失序：由于路由路径、距离、性能、繁忙程度不同导致；
4. 分组重复：缓存队列长导致发送端超时重发分组，最后重发的分组和缓存队列中的分组都被接收。
![[Pasted image 20240814120951.png]]
![[Pasted image 20240814121103.png]]
#### (1)可靠传输的实现机制：SW：停止-等待协议
确认ACK、否认NAK、误码重传机制
![[Pasted image 20240814121837.png]]
超时重传机制
![[Pasted image 20240814122149.png]]
数据分组DATA编号机制
![[Pasted image 20240814122548.png]]
确认分组ACK编号机制
![[Pasted image 20240814122945.png]]
至此，就可以在不可靠信道上实现可靠传输了。
![[Pasted image 20240814123919.png]]

![[Pasted image 20240816162745.png]]
![[Pasted image 20240814125402.png]]

![[Pasted image 20240814130443.png]]
![[Pasted image 20240816164322.png]]
#### (2)GBN：退回N帧协议
![[Pasted image 20240814134712.png]]

![[Pasted image 20240816165935.png]]
##### 无传输差错情况
![[Pasted image 20240816170207.png]]
![[Pasted image 20240814135937.png]]
发送窗口需要包含多个分组，取值为1时，不构成连续发送，即为停止-等待协议了。接收窗口值为1。
##### 超时重传、退回N帧情况(P24详解)
![[Pasted image 20240816170422.png]]
发送方连续发送5个数据分组， 其中2号分组误码，接收方成功接收到分组1、2，滑动窗口滑动2个单位，同时返回ACK1、2，然后将误码的分组3丢弃；
此时滑动窗口不向前滑动，导致分组3、4未能落入接收窗口也被丢弃，接收窗口不向前滑动，由于分组2误码丢弃，导致分组3、4没有按顺序，接收方每收到一个没按顺序到达的分组时返回一个最近已按序接收的分组的确认分组：ACK1；
此时发送方接收到ACK1、2，窗口前滑动2个单位，然后接收到两个ACK1，知道了分组2未被按序正确接收，并且导致后面的两个分组也被丢弃；
接收方收到分组5、6，未按序接收，丢弃。妈的，要写的太多了，看视频去。
![[Pasted image 20240814140312.png]]
**一个数据分组的差错，就可能引起大量数据分组的重传，在质量较差的信道上，GBN协议的信道利用率不比SW协议要高。**

![[Pasted image 20240814141004.png]]
![[Pasted image 20240814141556.png]]

**发送窗口的取值不能超过其取值范围的上限的原因：**
![[Pasted image 20240814142744.png]]
3比特编号，WT范围是2-7，当WT=7，发送方发送分组0-6，接收方接收后WR停在7序号同时返回ACK6，若ACK6丢失，发送方会超时重传分组0-6，接收方无法按序接收全部丢弃，返回7个ACK6，此时发送方知道分组6前的全部收到了，窗口前滑动7个单位（7012345），再次发送。

当发送方收到0号帧的确认ACK0时，将发送窗口向前滑动一个位置，将已收到确认的0号数据帧的序号，移出发送窗口，这样就有一个新的序号落入发送窗口。
![[Pasted image 20240814143233.png]]

![[Pasted image 20240814143600.png]]
收到ACK发送窗口向前滑动，新序号落入发送窗口，收到3号帧确认后计时器超时，表示4-7号帧没传过去，但是此时发送窗口内序号是4 5 6 7 8 9 10 11一共8个序号，但是题目问的是**需要重新发送的帧数是多少**？自然不含8-11。

![[Pasted image 20240814153957.png]]
发送1帧时间0.08ms
发送1帧且收到ACK1时间（一个周期）：100.08ms
意味着从开始发送，0.08ms后在发送第2帧，由于发送窗口尺寸1000帧，所以GBN连续发送1000帧时间为：80ms<100.08ms，20ms时间差在等待**ACK1的返回，ACK1不返回发送窗口不会向后移动**。综上，100.08ms内发送了1000帧\*1000字节\*8b的数据，换算单位为80Mbps。

![[Pasted image 20240814154800.png]]
#### (3)SR：选择重传协议
![[Pasted image 20240814160543.png]]
为了使发送方仅重传出现差错的数据分组，接收方不再采用累积确认，而需要对每一个正确接收的数据分组进行逐一确认。

**发送窗口的取值不能超过其取值范围的上限的原因：**
![[Pasted image 20240814161107.png]]

![[Pasted image 20240814162355.png]]

![[Pasted image 20240816194043.png]]
## 3.3点对点协议PPP
![[Pasted image 20240816194414.png]]
![[Pasted image 20240814162859.png]]
![[Pasted image 20240814165718.png]]
### PPP帧
![[Pasted image 20240814163348.png]]
### PPP帧的透明传输
![[Pasted image 20240814164301.png]]
![[Pasted image 20240814164603.png]]
### PPP帧的差错检测
![[Pasted image 20240814170142.png]]
![[Pasted image 20240814165402.png]]
### PPP的工作状态
![[Pasted image 20240814170439.png]]
## 3.4共享式以太网
![[Pasted image 20240814174356.png]]
以太网目前已经从传统的共享式以太网发展到交换式以太网，传输速率已经从10Mb/s提高到100Mb/s、1Gb/s甚至 10Gb/s。

我们会首先介绍最早流行的传输速率为10Mb/s的共享式以太网的相关知识。
### 3.4.1网络适配器和MAC地址
#### 网络适配器
![[Pasted image 20240814181616.png]]
![[Pasted image 20240814174759.png]]
![[Pasted image 20240814175017.png]]
#### MAC地址
![[Pasted image 20240816200446.png]]

![[Pasted image 20240814175209.png]]
![[Pasted image 20240814175306.png]]
MAC地址也叫物理地址，但是它属于数据链路层范畴。
![[Pasted image 20240814175603.png]]

![[Pasted image 20240814175459.png]]

IEEE 802局域网的MAC地址格式：
![[Pasted image 20240814175905.png]]
- 字节发送顺序：1-6
- 比特发送顺序：b0-b7

![[Pasted image 20240814180224.png]]
MAC地址6字节一共48比特。

![[Pasted image 20240814181445.png]]
全球单播MAC地址就如同身份证上的身份证号码，具有唯一性，它往往与用户个人信息绑定在一起。因此，用户应尽量确保自己拥有的全球单播MAC地址不被泄露。
为了避免用户设备连接Wi-Fi热点时MAC地址泄露的安全问题，目前大多数移动设备都已经采用了随机MAC地址技术。
### 3.4.2CSMA/CD协议
![[Pasted image 20240814182112.png]]
![[Pasted image 20240814182201.png]]
![[Pasted image 20240814182229.png]]
![[Pasted image 20240814182547.png]]
![[Pasted image 20240814182914.png]]

![[Pasted image 20240814183231.png]]
### 3.4.3共享式以太网争用期、最小帧长、最大帧长
#### 争用期
![[Pasted image 20240814190235.png]]
碰撞后A的发送帧依旧会往D走，直到D接收到，才会发现碰撞了。
t=0时，A帧出发，经过τ时后会到达D；
当A帧走了一段时间后，距离D还有δ时，此时D帧发送；
此时A帧和D帧相向而行，所以δ/2时后碰撞；
碰撞后A帧继续走，共计τ时后到达D，此时D才检测到碰撞，停止发送帧；
D帧τ-δ时发送，经过τ时，也就是2τ-δ后到达A，此时A检测到碰撞，停止发送帧。
![[Pasted image 20240814192628.png]]

![[Pasted image 20240814193538.png]]

#### 时间换算
![[Pasted image 20240814195544.png]]

![[Pasted image 20240814201533.png]]
#站点会载波监听信道空闲情况，96比特时间，怎么还会有2τ呢？如果是2τ，表示B站点没有载波监听。
#### 最小帧长
![[Pasted image 20240814202631.png]]
**为什么要求在发送一个帧之前就要能够检测出碰撞？
因为CD碰撞检测是：边发送边检测碰撞，如果发完了就不会继续检测碰撞。**
#### 最大帧长
![[Pasted image 20240814225809.png]]
##### 以太网V2的MAC帧格式：
![[Pasted image 20240814202802.png]]

![[Pasted image 20240814221059.png]]
d=l/10是无量纲计算，分子l-800，则d-80
![[Pasted image 20240814224401.png]]
### 3.4.4共享式以太网退避算法、信道利用率
#### 退避算法
![[Pasted image 20240814230107.png]]
![[Pasted image 20240814230302.png]]
![[Pasted image 20240814230345.png]]
#### 信道利用率
![[Pasted image 20240814230635.png]]
![[Pasted image 20240814230719.png]]

![[Pasted image 20240814231124.png]]
### 3.4.5使用集线器的共享式以太网
![[Pasted image 20240814231608.png]]
![[Pasted image 20240814231847.png]]
### 3.4.6在物理层扩展以太网
![[Pasted image 20240814232756.png]]
![[Pasted image 20240814233238.png]]
![[Pasted image 20240814233434.png]]
![[Pasted image 20240814233643.png]]
### 3.4.7在数据链路层扩展以太网
#### 网桥
主机A给D发送单播帧：
![[Pasted image 20240815102054.png]]
网桥两个接口，左右以太网（局域网）各自是一个网段，碰撞域相互独立。


主机A发送广播帧：
![[Pasted image 20240815102544.png]]

![[Pasted image 20240815102837.png]]
#### 透明网桥的自学习
![[Pasted image 20240815103601.png]]
![[Pasted image 20240815104112.png]]
![[Pasted image 20240815104310.png]]
#### 透明网桥的生成树协议STP
![[Pasted image 20240815104719.png]]
![[Pasted image 20240815104832.png]]
![[Pasted image 20240815105125.png]]
## 3.5交换式以太网
![[Pasted image 20240815110730.png]]
### 3.5.1以太网交换机
![[Pasted image 20240815110946.png]]
![[Pasted image 20240815111134.png]]
![[Pasted image 20240815111403.png]]
#### 习题
![[Pasted image 20240815113155.png]]
X-E，X帧通过集线器到E和接口2，交换机1登记X2，查表发现E2，但X帧就是从接口2进来的，于是丢弃该帧，所以交换机2收不到该帧。
![[Pasted image 20240815113907.png]]
a1帧从交换机接口1进入交换机，交换机**自学习登记地址a1和接口1**，然后查表没找到c1的MAC地址，于是**盲目转发**给接口2和3，a1帧被从接口2转发到b1，b1丢弃帧。a1帧被从接口3转发到c1。c1发送确认帧c1，从接口3进入交换机，登记c1和3，查表确定a1的MAC地址和接口1，于是从接口1**明确转发**，a1收到确认帧。
![[Pasted image 20240815114801.png]]

![[Pasted image 20240815115840.png]]
![[Pasted image 20240815120220.png]]
### 3.5.2共享式VS交换式
集线器工作在物理层，它并不能识别帧首部中的目的MAC地址，因为这属于数据链路层的范畴，不管集线器收到的是单播帧还是广播帧，集线器仅仅是将表示帧的信号从其他所有接口转发出去。
交换机工作在链路层，可以识别帧结构，从首部中的目的MAC地址，查找转发表，根据查表结构对帧进行明确转发、盲目转发或丢弃。
![[Pasted image 20240815142112.png]]

![[Pasted image 20240815142501.png]]
交换机的实质是多接口网桥，网桥工作在数据链路层。被一个网桥连接的两个以太网称为网段。
#### 习题
![[Pasted image 20240815143311.png]]
交换机连接的一组工作站，当多主机之间同时，通信由于交换机可以对收到的帧存储转发，并能实现多对接口高速并行交换，因此不会产生碰撞。
![[Pasted image 20240815143727.png]]
交换机在收到帧后的操作是：**自学习和查表转发（明确转发、盲目转发、丢弃）**
![[Pasted image 20240815144116.png]]
![[Pasted image 20240815144351.png]]
## 3.6以太网的MAC帧格式
1. DIX Ethernet V2的帧格式(主流)
2. I triple E 802.3的帧格式
注意：以太网V2和802.3的帧格式仅**类型字段**有差别。
![[Pasted image 20240815145134.png]]
![[Pasted image 20240815145228.png]]
循环冗余校验CRC（常用，漏检率低）

![[Pasted image 20240815145819.png]]
## 3.7虚拟局域网VLAN
![[Pasted image 20240815154607.png]]
![[Pasted image 20240815154728.png]]
![[Pasted image 20240815155526.png]]
![[Pasted image 20240815154922.png]]
### 3.7.1VLAN概述
![[Pasted image 20240815155341.png]]
![[Pasted image 20240815155306.png]]
### 3.7.2VLAN实现机制
![[Pasted image 20240815155812.png]]
#### IEEE 802.1Q帧
![[Pasted image 20240815155915.png]]
![[Pasted image 20240815160236.png]]
![[Pasted image 20240815161417.png]]

![[Pasted image 20240815161827.png]]
#### 以太网交换机的接口类型
![[Pasted image 20240815162232.png]]交换机每个接口有且仅有一个PVID
Trunk接口用于交换机之间、或交换机和路由器之间的互连。Trunk接口可以属于多个VLAN，即Trunk接口可以通过不同VLAN的帧，默认情况Trunk接口的PVID=1。

![[Pasted image 20240815162838.png]]
根据接收帧接口的PVID给帧打VID标签。
VID`X`表示该帧所属VLAN`X`
PVID是交换机的接口，PVID1表示该接口属于VLAN1

![[Pasted image 20240815163827.png]]
因为广播帧VID=1，Trunk接口PVID=1，所以交换机1将广播帧去标签，以普通MAC帧的格式从接口5转发到交换机2，转发后再给该MAC打标签使其成为VID=1的802.1Q帧，该帧被转发出接口时还会再次去标签。

![[Pasted image 20240815164620.png]]
这里广播帧VID=2，Trunk接口PVID=1，直接以802.1Q帧的格式转发到交换机2。

★★★★★理解打标签和去标签原因：
![[Pasted image 20240815165422.png]]
#### 习题，答案DC
![[Pasted image 20240815170037.png]]
在典型的VLAN设置中，VLAN的主要功能之一就是隔离网络流量。因此，在这种情况下，主机A不会收到主机C发送的广播帧。广播帧在VLAN中只会在同一VLAN内进行广播，不会跨越VLAN传播。
在典型的VLAN配置中，主机A无法收到主机C发送的单播帧。原因是主机A和主机C属于不同的VLAN，而VLAN之间的通信是默认隔离的。
**在上方的VLAN概述中提到：属于同一VLAN的站点之间可以直接进行通信，而不同VLAN中的站点之间不能直接通信。**
![[Pasted image 20240815171038.png]]
如果需要跨VLAN通信，需要通过三层设备转发，比如路由器或三层交换机。
链路层用到的交换机是二层交换机，包含物理层和数据链路层，跨VLAN即是跨网段，需要网络层的支持，因此需要比如路由器（网络层工作）来实现。
## 3.8以太网的发展
传统以太网：10Mb/s的**共享总线以太网**
![[Pasted image 20240815175103.png]]
#### 100BASE-T
![[Pasted image 20240815180030.png]]
在交换机下无碰撞，不需要CSMA/CD协议，载波监听多址接入/碰撞检测协议。
#### 千兆以太网
![[Pasted image 20240815180505.png]]
![[Pasted image 20240815180917.png]]
**10Mb/s共享总线以太网（传统以太网）规定：争用期2τ的值为<font color=blue>512比特</font>的发送时间，千兆网将争用期2τ修改为<font color=blue>512字节</font>的发送时间。争用期2τ是CSMA/CD协议为了碰撞避免而提出的。全双工模式下不会出现信号碰撞情况，自然不需要CSMA/CD协议和该协议需要的载波延伸技术。**

![[Pasted image 20240815181936.png]]
![[Pasted image 20240815181031.png]]
![[Pasted image 20240815181856.png]]
![[Pasted image 20240814230719.png]]
#### 万兆以太网
![[Pasted image 20240815182340.png]]
## 3.9 802.11无线局域网
![[Pasted image 20240815182830.png]]
#### 有固定基础设施AP的802.11无线局域网
![[Pasted image 20240815183415.png]]
![[Pasted image 20240815183539.png]]
移动站A发送数据，通过AP1——分配系统DS——AP2——移动站B
![[Pasted image 20240815184050.png]]
![[Pasted image 20240815184144.png]]
![[Pasted image 20240815184236.png]]
#### 无固定基础设施的802.11无线局域网
![[Pasted image 20240815184759.png]]
![[Pasted image 20240815184934.png]]
![[Pasted image 20240815185144.png]]
### 3.9.1无线局域网物理层
![[Pasted image 20240815190625.png]]
### 3.9.2无线局域网链路层使用CSMA/CA协议
![[Pasted image 20240815191120.png]]
![[Pasted image 20240815191223.png]]
![[Pasted image 20240815191941.png]]
![[Pasted image 20240815192000.png]]
碰撞信号太弱导致AB站无法检测到碰撞信号，所以碰撞检测CD是没有意义的。
### 3.9.3CSMA/CA协议的工作原理
![[Pasted image 20240815200029.png]]
![[Pasted image 20240815225509.png]]

![[Pasted image 20240815233102.png]]
![[Pasted image 20240815201118.png]]
![[Pasted image 20240815200753.png]]

![[Pasted image 20240815202101.png]]

![[Pasted image 20240815222238.png]]
DIFS：帧间间隔
![[Pasted image 20240815222608.png]]
由图可知，连着发送就需要使用退避算法，如果发送的是第一个帧（即不是第一帧成功发送后连续的第二帧）则不需要，如上图信道空闲-DIFS-第一个数据帧部分。
#### CSMA/CA协议的退避算法
载波监听多址接入/碰撞避免
![[Pasted image 20240815223421.png]]
协议规定了基本退避时间为争用期2τ（单程端到端传播时延记为τ，2τ即为两倍的总线端到端的传播时延），具体的争用期时间是51.2μs。对于10Mbit/s以太网，在争用期内可发送512bit，即64字节。也可以说争用期 是512比特时间。1bit时间就是发送1比特所需的时间。（可以直接使用比特作为争用期的单位）
![[Pasted image 20240815224626.png]]
- BCD站刚好在A站帧发完就计时DIFS的原因是虚拟载波监听，A帧出现在信道上就被检测到了该帧所需要占用信道的时间是多少。
- **退避算法的目的是：防止某个源主机长时间独占信道（因为即使连续发送帧也需要等待一个DIFS和随机退避时间，期间别的主机就可以使用信道），并且通过随机退避时间也减少了发生碰撞的几率。**
![[Pasted image 20240815225822.png]]
![[Pasted image 20240815230204.png]]
**NAV一直在监听，所以当CTS出现在信到的时候就可能被检测到，图里画的是CTS经过传播时延后才被NAV检测到，其实我觉得RTS出现在信道的时候NAV就有可能检测到而显示信道忙了。BUT后面讲到其他站接收到CTS的信号才会启动NAV信道忙，其他站不动信号在动，图中相当于源站和其他站到目的站的单项时延相同，所以源站收到CTS的时候其他站才会收到CTS，启动NAV???**
#虚拟载波监听是每个时隙监听一次，时隙到底是啥。。。。
NAV一直在监听信道，当其他站检测到信道中传送的帧首部中的持续时间字段时，就会调整NAV，NAV表示信道从忙转入空闲状态的所需时间。这就是虚拟载波监听机制VCS。

RTS是请求发送控制帧（用于预约无线信道），CTS是允许发送控制帧（用于目的站回应源站请求）。
![[Pasted image 20240815230714.png]]
![[Pasted image 20240815230804.png]]
尽管如此，802.11无线局域网仍为用户提供了以下三种选择:
1. 使用RTS帧和CTS帧。
2. 只有当数据帧的长度超过某个数值时才使用RTS帧和CTS帧。
3. 不使用RTS帧和CTS帧。
![[Pasted image 20240815232434.png]]
利用虚拟载波监听机制，站点只要监听到数据帧、RTS帧（**隐蔽站问题导致其他站检测不到RTS帧的，这里写错了**）或CTS帧中的任何一个，就能知道信道将被占用的持续时间（NAV信道忙），而不需要真正监听到信道上的信号，因此虚拟载波监听机制能减少隐蔽站带。
![[Pasted image 20240815234102.png]]
#### 习题
![[Pasted image 20240815234217.png]]
![[Pasted image 20240815234354.png]]预约信道前的等待时间最长，因为要判断发送帧的优先级，是DIFS，而后面三个是SIFS ，是最小帧间间隔。
### 3.9.4无线局域网的MAC帧
在数据链路层的就是MAC帧，无论是在有线局域网还是无线局域网wifi上的都是！既然是MAC帧就会携带MAC地址哟~
![[Pasted image 20240816102257.png]]
#### 帧格式
![[Pasted image 20240816102647.png]]
尽管数据载荷的最大长度是2312字节，but通常802.11无线局域网的数据帧的长度都不超过1500字节。

![[Pasted image 20240816103055.png]]
![[Pasted image 20240816103119.png]]
![[Pasted image 20240816104925.png]]
- 地址1：由谁接收？
- 地址2：由谁直接发送？
- 地址3：源发/收地址。

![[Pasted image 20240817172729.png]]
AP具有网桥功能：透明网桥（发回来的MAC帧无需指明AP的MAC地址）、自学习！
#### 习题
![[Pasted image 20240816104908.png]]
# 四、网络层
